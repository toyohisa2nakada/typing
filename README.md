# 0. 概要

* タイピングゲームを作るための「ローマ字入力の正誤判定」を行うJavaScriptライブラリです
* 例えば「ひっしゅう」は、hisshuu, hisshilyuu, hiltushilyuuなどと複数の入力パターンがあります。それらを網羅した入力正誤判定を行うことができます
* ひらがな と、ローマ字のどこまでをすでに打ったのかを得ることができます

# 1. このライブラリを使用して作成したタイピングゲームの例

* [翔べ!ガンダムの歌詞](https://toyohisa2nakada.github.io/typing/simple_typing_game.html?%5B%5B%22%E3%82%82%E3%81%88%E3%81%82%E3%81%8C%E3%82%8C%22%2C%22%E7%87%83%E3%81%88%E4%B8%8A%E3%82%8C%22%5D%2C%5B%22%E3%82%82%E3%81%88%E3%81%82%E3%81%8C%E3%82%8C%22%2C%22%E7%87%83%E3%81%88%E4%B8%8A%E3%82%8C%22%5D%2C%5B%22%E3%82%82%E3%81%88%E3%81%82%E3%81%8C%E3%82%8C%22%2C%22%E7%87%83%E3%81%88%E4%B8%8A%E3%81%8C%E3%82%8C%22%5D%2C%5B%22%E3%81%8C%E3%82%93%E3%81%A0%E3%82%80%22%2C%22%E3%82%AC%E3%83%B3%E3%83%80%E3%83%A0%22%5D%2C%5B%22%E3%81%8D%E3%81%BF%E3%82%88%22%2C%22%E5%90%9B%E3%82%88%22%5D%2C%5B%22%E3%81%AF%E3%81%97%E3%82%8C%22%2C%22%E8%B5%B0%E3%82%8C%22%5D%2C%5B%22%E3%81%BE%E3%81%A0%E3%81%84%E3%81%8B%E3%82%8A%E3%81%AB%E3%82%82%E3%81%88%E3%82%8B%22%2C%22%E3%81%BE%E3%81%A0%E6%80%92%E3%82%8A%E3%81%AB%E7%87%83%E3%81%88%E3%82%8B%22%5D%2C%5B%22%E3%81%A8%E3%81%86%E3%81%97%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AA%E3%82%89%22%2C%22%E9%97%98%E5%BF%97%E3%81%8C%E3%81%82%E3%82%8B%E3%81%AA%E3%82%89%22%5D%2C%5B%22%E3%81%8D%E3%82%87%E3%81%A0%E3%81%84%E3%81%AA%E3%81%A6%E3%81%8D%E3%82%92%22%2C%22%E5%B7%A8%E5%A4%A7%E3%81%AA%E6%95%B5%E3%82%92%22%5D%2C%5B%22%E3%81%86%E3%81%A6%E3%82%88%22%2C%22%E8%A8%8E%E3%81%A6%E3%82%88%22%5D%2C%5B%22%E3%81%86%E3%81%A6%E3%82%88%22%2C%22%E8%A8%8E%E3%81%A6%E3%82%88%22%5D%2C%5B%22%E3%81%86%E3%81%A6%E3%82%88%22%2C%22%E8%A8%8E%E3%81%A6%E3%82%88%22%5D%2C%5B%22%E3%81%9B%E3%81%84%E3%81%8E%E3%81%AE%E3%81%84%E3%81%8B%E3%82%8A%E3%82%92%22%2C%22%E6%AD%A3%E7%BE%A9%E3%81%AE%E6%80%92%E3%82%8A%E3%82%92%22%5D%2C%5B%22%E3%81%B6%E3%81%A4%E3%81%91%E3%82%8D%22%2C%22%E3%81%B6%E3%81%A4%E3%81%91%E3%82%8D%22%5D%2C%5B%22%E3%81%8C%E3%82%93%E3%81%A0%E3%82%80%22%2C%22%E3%82%AC%E3%83%B3%E3%83%80%E3%83%A0%22%5D%2C%5B%22%E3%81%8D%E3%81%A9%E3%81%86%E3%81%9B%E3%82%93%E3%81%97%22%2C%22%E6%A9%9F%E5%8B%95%E6%88%A6%E5%A3%AB%22%5D%2C%5B%22%E3%81%8C%E3%82%93%E3%81%A0%E3%82%80%22%2C%22%E3%82%AC%E3%83%B3%E3%83%80%E3%83%A0%22%5D%2C%5B%22%E3%81%8C%E3%82%93%E3%81%A0%E3%82%80%22%2C%22%E3%82%AC%E3%83%B3%E3%83%80%E3%83%A0%22%5D%5D)
* [写経：般若心経](https://toyohisa2nakada.github.io/typing/simple_typing_game.html?%5B%5B%22%E3%81%B6%E3%81%A3%E3%81%9B%E3%81%A4%E3%81%BE%E3%81%8B%E3%81%AF%E3%82%93%E3%81%AB%E3%82%83%E3%81%AF%E3%82%89%E3%81%BF%E3%81%9F%E3%81%97%E3%82%93%E3%81%8E%E3%82%87%E3%81%86%22%2C%22%E4%BB%8F%E8%AA%AC%E6%91%A9%E8%A8%B6%E8%88%AC%E8%8B%A5%E6%B3%A2%E7%BE%85%E8%9C%9C%E5%A4%9A%E5%BF%83%E7%B5%8C%22%5D%2C%5B%22%E3%81%8B%E3%82%93%E3%81%98%E3%81%96%E3%81%84%E3%81%BC%E3%81%95%E3%81%8E%E3%82%87%E3%81%86%E3%81%98%E3%82%93%E3%81%AF%E3%82%93%E3%81%AB%E3%82%83%E3%81%AF%E3%82%89%E3%81%BF%E3%81%9F%22%2C%22%E8%A6%B3%E8%87%AA%E5%9C%A8%E8%8F%A9%E8%96%A9%E8%A1%8C%E6%B7%B1%E8%88%AC%E8%8B%A5%E6%B3%A2%E7%BE%85%E8%9C%9C%E5%A4%9A%22%5D%2C%5B%22%E3%81%98%E3%81%97%E3%82%87%E3%81%86%E3%81%91%E3%82%93%E3%81%94%E3%81%86%E3%82%93%E3%81%8B%E3%81%84%E3%81%8F%E3%81%A9%E3%81%84%E3%81%A3%E3%81%95%E3%81%84%E3%81%8F%E3%82%84%E3%81%8F%22%2C%22%E6%99%82%E7%85%A7%E8%A6%8B%E4%BA%94%E8%98%8A%E7%9A%86%E7%A9%BA%E5%BA%A6%E4%B8%80%E5%88%87%E8%8B%A6%E5%8E%84%22%5D%2C%5B%22%E3%81%97%E3%82%83%E3%82%8A%E3%81%97%E3%81%97%E3%81%8D%E3%81%B5%E3%81%84%E3%81%8F%E3%81%86%E3%81%8F%E3%81%86%E3%81%B5%E3%81%84%E3%81%97%E3%81%8D%E3%81%97%E3%81%8D%E3%81%9D%E3%81%8F%E3%81%9C%22%2C%22%E8%88%8E%E5%88%A9%E5%AD%90%E8%89%B2%E4%B8%8D%E7%95%B0%E7%A9%BA%E7%A9%BA%E4%B8%8D%E7%95%B0%E8%89%B2%E8%89%B2%E5%8D%B3%E6%98%AF%22%5D%2C%5B%22%E3%81%8F%E3%81%86%E3%81%8F%E3%81%86%E3%81%9D%E3%81%8F%E3%81%9C%E3%81%97%E3%81%8D%E3%81%98%E3%82%85%E3%81%9D%E3%81%86%E3%81%8E%E3%82%87%E3%81%86%E3%81%97%E3%81%8D%E3%82%84%E3%81%8F%E3%81%B6%E3%81%AB%E3%82%87%E3%81%9C%22%2C%22%E7%A9%BA%E7%A9%BA%E5%8D%B3%E6%98%AF%E8%89%B2%E5%8F%97%E6%83%B3%E8%A1%8C%E8%AD%98%E4%BA%A6%E5%BE%A9%E5%A6%82%E6%98%AF%22%5D%5D)
* [円周率](https://toyohisa2nakada.github.io/typing/simple_typing_game.html?%5B%5B%223.%22%2C%221%E6%A1%81%E7%9B%AE%E3%81%A8%E5%B0%8F%E6%95%B0%E7%82%B9%22%5D%2C%5B%22141592653589%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B91%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8912%E6%A1%81%E7%9B%AE%22%5D%2C%5B%22793238462643%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B913%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8924%E6%A1%81%E7%9B%AE%22%5D%2C%5B%22383279502884%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B925%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8936%E6%A1%81%E7%9B%AE%22%5D%2C%5B%22197169399375%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B937%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8948%E6%A1%81%E7%9B%AE%22%5D%2C%5B%22105820974944%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B949%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8960%E6%A1%81%E7%9B%AE%22%5D%2C%5B%22592307816406%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B961%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8972%E6%A1%81%E7%9B%AE%22%5D%2C%5B%22286208998628%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B973%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8984%E6%A1%81%E7%9B%AE%22%5D%2C%5B%22034825342117%22%2C%22%E5%B0%8F%E6%95%B0%E7%82%B985%E6%A1%81%E7%9B%AE%E3%81%8B%E3%82%8996%E6%A1%81%E7%9B%AE%22%5D%5D)
* [英単語の勉強](https://toyohisa2nakada.github.io/typing/simple_typing_game.html?%5B%5B%22invade%22%2C%22%E4%BE%B5%E7%95%A5%E3%81%99%E3%82%8B%22%5D%2C%5B%22lift%22%2C%22%E4%B8%8A%E3%81%92%E3%82%8B%22%5D%2C%5B%22mental%22%2C%22%E7%B2%BE%E7%A5%9E%E3%81%AE%22%5D%2C%5B%22majority%22%2C%22%E5%A4%A7%E5%A4%9A%E6%95%B0%E3%80%81%E5%A4%A7%E9%83%A8%E5%88%86%22%5D%2C%5B%22quiet%22%2C%22%E9%9D%99%E3%81%8B%E3%81%AA%22%5D%2C%5B%22stay%22%2C%22%E6%B3%8A%E3%81%BE%E3%82%8B%E3%80%81%E6%BB%9E%E5%9C%A8%E3%81%99%E3%82%8B%22%5D%2C%5B%22thin%22%2C%22%E8%96%84%E3%81%84%E3%80%81%E7%B4%B0%E3%81%84%22%5D%5D)
* [休暇願を上司に送る？](https://toyohisa2nakada.github.io/typing/simple_typing_game.html?%5B%5B%22%E3%81%8A%E3%81%A4%E3%81%8B%E3%82%8C%E3%81%95%E3%81%BE%E3%81%A7%E3%81%99%E3%80%82%22%2C%22%E3%81%8A%E7%96%B2%E3%82%8C%E6%A7%98%E3%81%A7%E3%81%99%E3%80%82%22%5D%2C%5B%22%E3%81%93%E3%81%AE%E3%81%9F%E3%81%B3%22%2C%22%E3%81%93%E3%81%AE%E5%BA%A6%22%5D%2C%5B%22%E3%82%86%E3%81%86%E3%81%8D%E3%82%85%E3%81%86%E3%81%8D%E3%82%85%E3%81%86%E3%81%8B%E3%82%92%22%2C%22%E6%9C%89%E7%B5%A6%E4%BC%91%E6%9A%87%E3%82%92%22%5D%2C%5B%22%E3%81%97%E3%82%85%E3%81%A8%E3%81%8F%E3%81%97%E3%81%9F%E3%81%8F%22%2C%22%E5%8F%96%E5%BE%97%E3%81%97%E3%81%9F%E3%81%8F%22%5D%2C%5B%22%E3%81%93%E3%81%93%E3%81%AB%22%2C%22%E3%81%93%E3%81%93%E3%81%AB%22%5D%2C%5B%22%E3%81%8A%E3%81%A8%E3%81%A9%E3%81%91%E3%81%84%E3%81%9F%E3%81%97%E3%81%BE%E3%81%99%E3%80%82%22%2C%22%E3%81%8A%E5%B1%8A%E3%81%91%E3%81%84%E3%81%9F%E3%81%97%E3%81%BE%E3%81%99%E3%80%82%22%5D%5D)
* [Pythonプログラム](https://toyohisa2nakada.github.io/typing/simple_typing_game.html?%5B%5B%22import%20random%5Cnrandom.seed(0)%5Cnar%20%3D%20%5Brandom.random()%20for%20i%20in%20range(16)%5D%5Cnprint(f%5C%22list%3D%7Bar%7D%5C%22)%5Cnsum_gusu_idx%20%3D%200%5Cnfor%20i%2Cv%20in%20enumerate(ar)%3A%5Cn%20%20%20%20if%20i%20%25%202%20%3D%3D%200%3A%5Cn%20%20%20%20%20%20%20%20sum_gusu_idx%20%2B%3D%20v%5Cnprint(f%5C%22the%20sum%20of%20the%20numbers%20at%20even%20indices%20is%20%7Bsum_gusu_idx%7D.%5C%22)%22%5D%5D)

# 2. ダウンロード

https://github.com/toyohisa2nakada/typing/tree/main

ライブラリは、keygraph.js ファイルです。
simple_typing_game.htmlファイルがライブラリを使ったタイピングゲームの例です。
simple_typing_game.htmlでは、keygraph.js以外にsound.jsファイルも読み込みます。

# 3. ライブラリの使い方

```html:simple_typing_game.html
<!-- ライブラリの読み込み -->
<script src="keygraph.js"></script>

<script>
    // DAGの作成、keygraph.jsを読み込むとkeygraph変数が使えるようになります。
    keygraph.build("ひっしゅう");

    // これから打つキー、すでに打ったキーを表示、 ... は適宜変更してください。
    const disp = ()=>{
        // これからタイプしなければいけないキーの取得
        document.getElementById("...").innerText = keygraph.key_candidate();

        // タイプし終わったキーの取得
        document.getElementById("...").innerText = keygraph.key_done();

        // これから打つ ひらがな の取得
        document.getElementById("...").innerText = keygraph.seq_candidates();
    
        // 打ち終わった ひらがな の取得
        document.getElementById("...").innerText = keygraph.seq_done();
    }

    // keydownのイベント処理
    document.body.addEventListener("keydown", e => {
        if (keygraph.next(e.key)) {
            // 入力がタイピングするキーと一致している場合
        }
        if (keygraph.is_finished()) {
            // すべての文字をタイプし終わったとき
        }
        disp();
    });
    disp();
</script>
```


<details><summary>これからタイプしなければいけないローマ字について</summary><div>
タイピングゲームでは、タイプするローマ字を画面に表示することがよくあります。例えば「ひっしゅう」ならば「hisshu」という文字が表示されて、すでに打った文字が暗くなったりしてどこまで打ったのかをユーザが分かるようにします。この「hisshu」に相当する文字列を取得するのが keygraph.key_candidate 関数です。keygraph.key_candidateは、「hisshu」や「hisshilyuu」のように複数のパターンから「1つ」が選ばれて文字列として戻るわけですが、その選ばれる基準は、keygraph.jsファイルの下の方で定義されている_char_keys_tableリストの順序で決まります。リストの上の方、また同じ ひらがな ならば keys変数で定義されたキー候補の左の方が優先されます。例えば「っしゅ」の場合、_char_keys_tableリストの「っ」「っし」「っしゅ」の3つがまず候補になるのですが、最もリストの上にある「っしゅ」が選ばれます。そして「っしゅ」のキー候補である["ssyu", "sshu"]のうち左側の"ssyu"が選ばれることになります。例えば「っし」が_char_keys_tableリストの上位にあれば「っし」のkeys変数の左側が選ばれ、そして残りの文字の「ゅ」の定義の中でkeys変数の左側のローマ字が選ばれて全部のローマ字が完成するということになります。よって画面に表示するローマ字を変更したい場合、_char_keys_tableリストのデータの順序を入れ替えることで対応できます。
</div></details>

# 4. タイプする文字を自分で作成するアプリ

[オンラインデモ](https://toyohisa2nakada.github.io/typing/simple_typing_game_maker.html)

タイピングゲームのアプリ例である simple_typing_game.html は、URL引数によってタイプする文字を指定することができます。以下のは、そのURL引数を作成するアプリの例です。

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/275020/faa21fa5-edb7-3749-7af3-460ffc7b55d0.png)
↑ の左側で漢字混じりの日本語を打つと、右側に ひらがな が自動作成されます。自動変換された ひらがな は、間違えていれば自分で修正することもできます。登録した文字を打つタイピングゲームのURLは画面下に表示され、URLにマウスをもっていくと「実行」「URLの短縮」「URLのコピー」のそれぞれのボタンが表示されます。URLの文字数が最大の4096文字になるまで文字を追加することができます。

<details><summary>ひらがな 自動変換について</summary><div>
ひらがな への自動変換は、<a href="https://labs.goo.ne.jp/">gooらぼ</a>の ひらがな化APIを使用させていただいています。</div></details>

<details><summary>短縮URLについて</summary><div>
URL短縮には、<a href="https://tinyurl.com/app/dev">TinyURL OpenApi</a>を使用させていただいています。</div></details>



詳しくは[Qiitaの記事](https://qiita.com/toyohisa/items/17c8c0c8342b894e2470)をご覧ください。
